{"code":"import { __awaiter, __rest } from \"tslib\";\nimport { defineComponent } from \"vue\";\nexport default defineComponent({\n    data() {\n        return {\n            username: '',\n            password: ''\n        };\n    },\n    methods: {\n        onLoginSubmit() {\n            return __awaiter(this, void 0, void 0, function* () {\n                const _a = this, username = _a.username, password = _a.password;\n                if (!username || !password) {\n                    uni.showToast({ title: '请填写账号和密码', icon: 'none' });\n                    return Promise.resolve(null);\n                }\n                try {\n                    const res = yield uniCloud.callFunction({\n                        name: 'user-api',\n                        data: new UTSJSONObject({\n                            action: 'login',\n                            username,\n                            password\n                        })\n                    });\n                    uni.__f__('log', 'at pages/user/login/login.uvue:62', '云函数返回结果:', res); // 添加日志\n                    const _b = res.result || new UTSJSONObject({}), code = _b.code, message = _b.message, data = _b.data;\n                    uni.__f__('log', 'at pages/user/login/login.uvue:66', '解析结果:', new UTSJSONObject({ code, message, data })); // 添加日志\n                    if (code === 0 && data && data.token) {\n                        // 从 data 中提取 token 和用户信息\n                        const token = data.token, userInfo = __rest(data, [\"token\"]);\n                        uni.__f__('log', 'at pages/user/login/login.uvue:72', '登录成功，用户信息:', userInfo); // 添加日志\n                        // 存储 token 和用户信息\n                        uni.setStorageSync('uni_id_token', token);\n                        uni.setStorageSync('user_info', userInfo);\n                        // 显示成功提示\n                        uni.showToast({\n                            title: '登录成功',\n                            icon: 'success',\n                            duration: 1500\n                        });\n                        // 延迟跳转，让用户看到成功提示\n                        setTimeout(() => {\n                            uni.switchTab({\n                                url: '/pages/comtent/list/list'\n                            });\n                        }, 1500);\n                    }\n                    else {\n                        // 登录失败，显示后端返回的错误信息\n                        uni.__f__('error', 'at pages/user/login/login.uvue:94', '登录失败:', new UTSJSONObject({ code, message, data }));\n                        let errorMessage = '登录失败';\n                        if (message) {\n                            errorMessage = message;\n                        }\n                        else if (code === 1001) {\n                            errorMessage = '用户不存在';\n                        }\n                        else if (code === 1002) {\n                            errorMessage = '密码错误';\n                        }\n                        else if (code === 1003) {\n                            errorMessage = '账号已被禁用';\n                        }\n                        uni.showToast({\n                            title: errorMessage,\n                            icon: 'none',\n                            duration: 3000\n                        });\n                    }\n                }\n                catch (err) {\n                    uni.__f__('error', 'at pages/user/login/login.uvue:114', '登录请求失败:', err);\n                    let errorMessage = '网络错误，请检查网络连接';\n                    // 解析错误信息\n                    if (err && typeof err === 'object') {\n                        if (err.errCode || err.errMsg) {\n                            errorMessage = err.errMsg || `错误代码: ${err.errCode}`;\n                        }\n                        else if (err.message) {\n                            errorMessage = err.message;\n                        }\n                    }\n                    uni.showToast({\n                        title: errorMessage,\n                        icon: 'none',\n                        duration: 3000\n                    });\n                }\n            });\n        }\n    }\n});\n//# sourceMappingURL=D:/%E8%BD%AF%E5%B7%A5%E5%A4%A7%E4%BD%9C%E4%B8%9A/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%95%8C%E9%9D%A2/pages/user/login/login.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.showToast","uniCloud.callFunction","uni.__f__","uni.setStorageSync","uni.switchTab"],"map":"{\"version\":3,\"file\":\"login.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"login.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
