{"code":"import { __awaiter, __rest } from \"tslib\";\nimport { defineComponent } from \"vue\";\nexport default defineComponent({\n    data() {\n        return {\n            username: '',\n            password: '',\n            confirmPassword: '',\n            isLoading: false\n        };\n    },\n    methods: {\n        onRegisterSubmit() {\n            return __awaiter(this, void 0, void 0, function* () {\n                const _a = this, username = _a.username, password = _a.password, confirmPassword = _a.confirmPassword;\n                // 表单验证\n                if (!username.trim()) {\n                    uni.showToast({\n                        title: '请输入用户名',\n                        icon: 'none'\n                    });\n                    return Promise.resolve(null);\n                }\n                if (!password) {\n                    uni.showToast({\n                        title: '请输入密码',\n                        icon: 'none'\n                    });\n                    return Promise.resolve(null);\n                }\n                if (password.length < 6) {\n                    uni.showToast({\n                        title: '密码长度至少6位',\n                        icon: 'none'\n                    });\n                    return Promise.resolve(null);\n                }\n                if (password !== confirmPassword) {\n                    uni.showToast({\n                        title: '两次密码不一致',\n                        icon: 'none'\n                    });\n                    return Promise.resolve(null);\n                }\n                // 开始注册\n                this.isLoading = true;\n                try {\n                    const res = yield uniCloud.callFunction({\n                        name: 'user-api',\n                        data: new UTSJSONObject({\n                            action: 'register',\n                            username: username.trim(),\n                            password\n                        })\n                    });\n                    uni.__f__('log', 'at pages/user/register/register.uvue:114', '注册返回结果:', res);\n                    const _b = res.result || new UTSJSONObject({}), code = _b.code, message = _b.message, data = _b.data;\n                    if (code === 0 && data && data.token) {\n                        // 注册成功，自动登录\n                        const token = data.token, userInfo = __rest(data, [\"token\"]);\n                        uni.setStorageSync('uni_id_token', token);\n                        uni.setStorageSync('user_info', userInfo);\n                        uni.showToast({\n                            title: '注册成功',\n                            icon: 'success',\n                            duration: 1500\n                        });\n                        // 延迟跳转到首页\n                        setTimeout(() => {\n                            uni.switchTab({\n                                url: '/pages/content/list/list'\n                            });\n                        }, 1500);\n                    }\n                    else {\n                        // 注册失败\n                        let errorMessage = '注册失败';\n                        if (message) {\n                            errorMessage = message;\n                        }\n                        else if (code === 1004) {\n                            errorMessage = '用户名已存在';\n                        }\n                        else if (code === 1002) {\n                            errorMessage = '密码错误';\n                        }\n                        else if (code === 1003) {\n                            errorMessage = '账号已被禁用';\n                        }\n                        uni.showToast({\n                            title: errorMessage,\n                            icon: 'none',\n                            duration: 3000\n                        });\n                    }\n                }\n                catch (err) {\n                    uni.__f__('error', 'at pages/user/register/register.uvue:158', '注册请求失败:', err);\n                    let errorMessage = '注册失败，请稍后重试';\n                    if (err && err.errMsg) {\n                        errorMessage = err.errMsg;\n                    }\n                    else if (err && err.message) {\n                        errorMessage = err.message;\n                    }\n                    uni.showToast({\n                        title: errorMessage,\n                        icon: 'none',\n                        duration: 3000\n                    });\n                }\n                finally {\n                    this.isLoading = false;\n                }\n            });\n        },\n        goBackToLogin() {\n            uni.redirectTo({\n                url: '/pages/user/login/login'\n            });\n        }\n    }\n});\n//# sourceMappingURL=D:/%E8%BD%AF%E5%B7%A5%E5%A4%A7%E4%BD%9C%E4%B8%9A/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%95%8C%E9%9D%A2/pages/user/register/register.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.showToast","uniCloud.callFunction","uni.__f__","uni.setStorageSync","uni.switchTab","uni.redirectTo"],"map":"{\"version\":3,\"file\":\"register.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"register.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\";;AACA,+BAAe;IACb,IAAI;QACF,OAAO;YACL,QAAQ,EAAE,EAAE;YACZ,QAAQ,EAAE,EAAE;YACZ,eAAe,EAAE,EAAE;YACnB,SAAS,EAAE,KAAK;SACjB,CAAC;IACJ,CAAC;IACD,OAAO,EAAE;QACD,gBAAgB;;gBAEd,MAAA,KAA0C,IAAI,EAA5C,QAAQ,cAAA,EAAE,QAAQ,cAAA,EAAE,eAAe,qBAAS,CAAC;gBAErD,OAAO;gBACP,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,EAAE;oBACpB,GAAG,CAAC,SAAS,CAAC;wBACZ,KAAK,EAAE,QAAQ;wBACf,IAAI,EAAE,MAAM;qBACb,CAAC,CAAC;oBACH,6BAAO;iBACR;gBAED,IAAI,CAAC,QAAQ,EAAE;oBACb,GAAG,CAAC,SAAS,CAAC;wBACZ,KAAK,EAAE,OAAO;wBACd,IAAI,EAAE,MAAM;qBACb,CAAC,CAAC;oBACH,6BAAO;iBACR;gBAED,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;oBACvB,GAAG,CAAC,SAAS,CAAC;wBACZ,KAAK,EAAE,UAAU;wBACjB,IAAI,EAAE,MAAM;qBACb,CAAC,CAAC;oBACH,6BAAO;iBACR;gBAED,IAAI,QAAQ,KAAK,eAAe,EAAE;oBAChC,GAAG,CAAC,SAAS,CAAC;wBACZ,KAAK,EAAE,SAAS;wBAChB,IAAI,EAAE,MAAM;qBACb,CAAC,CAAC;oBACH,6BAAO;iBACR;gBAED,OAAO;gBACP,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;gBAEtB,IAAI;oBACF,MAAM,GAAG,GAAG,MAAM,QAAQ,CAAC,YAAY,CAAC;wBACtC,IAAI,EAAE,UAAU;wBAChB,IAAI,oBAAE;4BACJ,MAAM,EAAE,UAAU;4BAClB,QAAQ,EAAE,QAAQ,CAAC,IAAI,EAAE;4BACzB,QAAQ;yBACT,CAAA;qBACF,CAAC,CAAC;oBAEH,GAAG,CAAC,KAAK,CAAC,KAAK,EAAC,0CAA0C,EAAC,SAAS,EAAE,GAAG,CAAC,CAAC;oBAErE,MAAA,KAA0B,GAAG,CAAC,MAAM,sBAAI,EAAE,CAAA,EAAxC,IAAI,UAAA,EAAE,OAAO,aAAA,EAAE,IAAI,UAAqB,CAAC;oBAEjD,IAAI,IAAI,KAAK,CAAC,IAAI,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE;wBACpC,YAAY;wBACJ,MAAA,KAAK,GAAkB,IAAI,MAAtB,EAAK,QAAQ,UAAK,IAAI,EAA7B,SAAsB,CAAF,CAAU;wBAEpC,GAAG,CAAC,cAAc,CAAC,cAAc,EAAE,KAAK,CAAC,CAAC;wBAC1C,GAAG,CAAC,cAAc,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;wBAE1C,GAAG,CAAC,SAAS,CAAC;4BACZ,KAAK,EAAE,MAAM;4BACb,IAAI,EAAE,SAAS;4BACf,QAAQ,EAAE,IAAI;yBACf,CAAC,CAAC;wBAEH,UAAU;wBACV,UAAU,CAAC;4BACT,GAAG,CAAC,SAAS,CAAC;gCACZ,GAAG,EAAE,0BAA0B;6BAChC,CAAC,CAAC;wBACL,CAAC,EAAE,IAAI,CAAC,CAAC;qBACV;yBAAM;wBACL,OAAO;wBACP,IAAI,YAAY,GAAG,MAAM,CAAC;wBAE1B,IAAI,OAAO,EAAE;4BACX,YAAY,GAAG,OAAO,CAAC;yBACxB;6BAAM,IAAI,IAAI,KAAK,IAAI,EAAE;4BACxB,YAAY,GAAG,QAAQ,CAAC;yBACzB;6BAAM,IAAI,IAAI,KAAK,IAAI,EAAE;4BACxB,YAAY,GAAG,MAAM,CAAC;yBACvB;6BAAM,IAAI,IAAI,KAAK,IAAI,EAAE;4BACxB,YAAY,GAAG,QAAQ,CAAC;yBACzB;wBAED,GAAG,CAAC,SAAS,CAAC;4BACZ,KAAK,EAAE,YAAY;4BACnB,IAAI,EAAE,MAAM;4BACZ,QAAQ,EAAE,IAAI;yBACf,CAAC,CAAC;qBACJ;iBACF;gBAAC,OAAO,GAAG,EAAE;oBACZ,GAAG,CAAC,KAAK,CAAC,OAAO,EAAC,0CAA0C,EAAC,SAAS,EAAE,GAAG,CAAC,CAAC;oBAE7E,IAAI,YAAY,GAAG,YAAY,CAAC;oBAChC,IAAI,GAAG,IAAI,GAAG,CAAC,MAAM,EAAE;wBACrB,YAAY,GAAG,GAAG,CAAC,MAAM,CAAC;qBAC3B;yBAAM,IAAI,GAAG,IAAI,GAAG,CAAC,OAAO,EAAE;wBAC7B,YAAY,GAAG,GAAG,CAAC,OAAO,CAAC;qBAC5B;oBAED,GAAG,CAAC,SAAS,CAAC;wBACZ,KAAK,EAAE,YAAY;wBACnB,IAAI,EAAE,MAAM;wBACZ,QAAQ,EAAE,IAAI;qBACf,CAAC,CAAC;iBACJ;wBAAS;oBACR,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;iBACxB;YACH,CAAC;SAAA;QAED,aAAa;YACX,GAAG,CAAC,UAAU,CAAC;gBACb,GAAG,EAAE,yBAAyB;aAC/B,CAAC,CAAC;QACL,CAAC;KACF;CACF,EAAC\"}"}
