{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent as _defineComponent } from 'vue';\nimport { o as _o, gei as _gei, sei as _sei } from \"vue\";\nimport { ref } from 'vue';\n// 数据响应式\nexport default /*#__PURE__*/ _defineComponent({\n    __name: 'change-password',\n    setup(__props) {\n        const oldPassword = ref('');\n        const newPassword = ref('');\n        const confirmPassword = ref('');\n        // 输入事件处理\n        function onOldPasswordInput(e = null) {\n            oldPassword.value = e.detail.value;\n        }\n        function onNewPasswordInput(e = null) {\n            newPassword.value = e.detail.value;\n        }\n        function onConfirmPasswordInput(e = null) {\n            confirmPassword.value = e.detail.value;\n        }\n        // 返回上一页\n        function onBackTap() {\n            uni.navigateBack(new UTSJSONObject({ delta: 1 }));\n        }\n        // 提交修改（真实调用云函数）\n        function handleSubmit() {\n            return __awaiter(this, void 0, void 0, function* () {\n                const oldPwd = oldPassword.value.trim();\n                const newPwd = newPassword.value.trim();\n                const confirmPwd = confirmPassword.value.trim();\n                // 获取 token（从本地存储）\n                const token = uni.getStorageSync('uni_id_token');\n                if (!token) {\n                    uni.showToast({ title: '请先登录', icon: 'none' });\n                    setTimeout(() => { return uni.redirectTo({ url: '/pages/user/login/login' }); }, 1500);\n                    return Promise.resolve(null);\n                }\n                if (!oldPwd) {\n                    uni.showToast({ title: '请输入原密码', icon: 'none' });\n                    return Promise.resolve(null);\n                }\n                if (!newPwd || newPwd.length < 6) {\n                    uni.showToast({ title: '新密码至少6位', icon: 'none' });\n                    return Promise.resolve(null);\n                }\n                if (newPwd !== confirmPwd) {\n                    uni.showToast({ title: '两次密码不一致', icon: 'none' });\n                    return Promise.resolve(null);\n                }\n                try {\n                    // 显示加载中\n                    uni.showLoading({ title: '修改中...' });\n                    // 调用云函数 update-password\n                    const res = yield uniCloud.callFunction({\n                        name: 'user-api',\n                        data: new UTSJSONObject({\n                            action: 'update-password',\n                            uniIdToken: token,\n                            old_password: oldPwd,\n                            new_password: newPwd,\n                            confirm_password: confirmPwd\n                        })\n                    });\n                    // 隐藏加载\n                    uni.hideLoading();\n                    const _a = res.result, code = _a.code, message = _a.message;\n                    if (code === 0) {\n                        uni.showToast({ title: '密码修改成功', icon: 'success' });\n                        setTimeout(() => {\n                            uni.navigateBack();\n                        }, 1500);\n                    }\n                    else {\n                        // 常见错误码处理（可扩展）\n                        let msg = message || '修改失败';\n                        if (code === 1002) {\n                            msg = '原密码错误';\n                        }\n                        else if (code === 401) {\n                            msg = '请先登录';\n                        }\n                        uni.showToast({ title: msg, icon: 'none', duration: 2000 });\n                    }\n                }\n                catch (err) {\n                    uni.hideLoading();\n                    uni.__f__('error', 'at pages/user/change-password/change-password.uvue:136', '[修改密码错误]', err);\n                    uni.showToast({ title: '网络异常，请重试', icon: 'none' });\n                }\n            });\n        }\n        return (_ctx, _cache) => {\n            \"raw js\";\n            const __returned__ = {\n                a: _o(onBackTap),\n                b: oldPassword.value,\n                c: _o(onOldPasswordInput),\n                d: newPassword.value,\n                e: _o(onNewPasswordInput),\n                f: confirmPassword.value,\n                g: _o(onConfirmPasswordInput),\n                h: _o(handleSubmit),\n                i: _sei(_gei(_ctx, ''), 'view')\n            };\n            return __returned__;\n        };\n    }\n});\n//# sourceMappingURL=D:/HBuilder-code/-/pages/user/change-password/change-password.uvue?vue&type=script&setup=true&lang.uts.js.map","references":["D:/HBuilder/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/HBuilder/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/HBuilder/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts"],"uniExtApis":["uni.navigateBack","uni.getStorageSync","uni.showToast","uni.redirectTo","uni.showLoading","uniCloud.callFunction","uni.hideLoading","uni.__f__"],"map":"{\"version\":3,\"file\":\"change-password.uvue?vue&type=script&setup=true&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"change-password.uvue?vue&type=script&setup=true&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
