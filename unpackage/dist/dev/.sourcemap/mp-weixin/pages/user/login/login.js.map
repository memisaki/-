{"version":3,"file":"login.js","sources":["pages/user/login/login.uvue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9sb2dpbi9sb2dpbi51dnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <view class=\"card\">\n      <view class=\"title\">朋友圈小程序</view>\n\n      <form @submit=\"onLoginSubmit\">\n        <view class=\"input-group\">\n          <text class=\"label\">账号</text>\n          <input\n            type=\"text\"\n            placeholder=\"请输入\"\n            v-model=\"username\"\n          />\n        </view>\n\n        <view class=\"input-group\">\n          <text class=\"label\">密码</text>\n          <input\n            type=\"password\"\n            placeholder=\"请输入\"\n            v-model=\"password\"\n          />\n        </view>\n\n        <button form-type=\"submit\" class=\"btn-login\">登录</button>\n      </form>\n\n      <navigator url=\"/pages/user/register/register\" class=\"btn-register\">\n        没有账号？点击注册\n      </navigator>\n    </view>\n  </view>\n</template>\n\n<script lang=\"uts\">\nexport default {\n  data() {\n    return {\n      username: '',\n      password: ''\n    };\n  },\n  methods: {\n    async onLoginSubmit() {\r\n      const { username, password } = this;\r\n    \r\n      if (!username || !password) {\r\n        uni.showToast({ title: '请填写账号和密码', icon: 'none' });\r\n        return;\r\n      }\r\n    \r\n      try {\r\n        const res = await uniCloud.callFunction({\r\n          name: 'user-api',\r\n          data: {\r\n            action: 'login',\r\n            username,\r\n            password\r\n          }\r\n        });\r\n    \r\n        uni.__f__('log','at pages/user/login/login.uvue:62','云函数返回结果:', res); // 添加日志\r\n        \r\n        const { code, message, data } = res.result || {};\r\n        \r\n        uni.__f__('log','at pages/user/login/login.uvue:66','解析结果:', { code, message, data }); // 添加日志\r\n        \r\n        if (code === 0 && data && data.token) {\r\n          // 从 data 中提取 token 和用户信息\r\n          const { token, ...userInfo } = data;\r\n          \r\n          uni.__f__('log','at pages/user/login/login.uvue:72','登录成功，用户信息:', userInfo); // 添加日志\r\n          \r\n          // 存储 token 和用户信息\r\n          uni.setStorageSync('uni_id_token', token);\r\n          uni.setStorageSync('user_info', userInfo);\r\n          \r\n          // 显示成功提示\r\n          uni.showToast({ \r\n            title: '登录成功', \r\n            icon: 'success',\r\n            duration: 1500\r\n          });\r\n          \r\n          // 延迟跳转，让用户看到成功提示\r\n          setTimeout(() => {\r\n            uni.switchTab({\r\n              url: '/pages/comtent/list/list' \r\n            });\r\n          }, 1500);\r\n          \r\n        } else {\r\n          // 登录失败，显示后端返回的错误信息\r\n          uni.__f__('error','at pages/user/login/login.uvue:94','登录失败:', { code, message, data });\r\n          \r\n          let errorMessage = '登录失败';\r\n          if (message) {\r\n            errorMessage = message;\r\n          } else if (code === 1001) {\r\n            errorMessage = '用户不存在';\r\n          } else if (code === 1002) {\r\n            errorMessage = '密码错误';\r\n          } else if (code === 1003) {\r\n            errorMessage = '账号已被禁用';\r\n          }\r\n          \r\n          uni.showToast({ \r\n            title: errorMessage, \r\n            icon: 'none',\r\n            duration: 3000\r\n          });\r\n        }\r\n      } catch (err) {\r\n        uni.__f__('error','at pages/user/login/login.uvue:114','登录请求失败:', err);\r\n        \r\n        let errorMessage = '网络错误，请检查网络连接';\r\n        \r\n        // 解析错误信息\r\n        if (err && typeof err === 'object') {\r\n          if (err.errCode || err.errMsg) {\r\n            errorMessage = err.errMsg || `错误代码: ${err.errCode}`;\r\n          } else if (err.message) {\r\n            errorMessage = err.message;\r\n          }\r\n        }\r\n        \r\n        uni.showToast({\r\n          title: errorMessage,\r\n          icon: 'none',\r\n          duration: 3000\r\n        });\r\n      }\r\n    }\n  }\n};\n</script>\n\n<style>\n/* 样式保持不变 */\n.container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100vh;\n  background-color: #f5f5f5;\n}\n\n.card {\n  width: 90%;\n  max-width: 947rpx;\n  padding: 80rpx;\n  border-radius: 50rpx;\n  background-color: white;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  text-align: center;\n}\n\n.title {\n  font-size: 48rpx;\n  margin-bottom: 80rpx;\n  color: #333;\n}\n\n.input-group {\n  margin-bottom: 40rpx;\n  text-align: left;\n}\n\n.label {\n  display: block;\n  margin-bottom: 10rpx;\n  font-size: 32rpx;\n  color: #555;\n}\n\ninput {\n  width: 100%;\n  padding: 10rpx;\n  border: 1rpx solid #ccc;\n  border-radius: 10rpx;\n  font-size: 32rpx;\n  box-sizing: border-box;\n}\n\n.btn-login {\n  width: 100%;\n  margin-top: 40rpx;\n  background-color: #007aff;\n  color: white;\n  border-radius: 30rpx;\n  font-size: 32rpx;\n  padding: 20rpx;\n  border: none;\n}\n\n.btn-register {\n  display: block;\n  margin-top: 20rpx;\n  color: #007aff;\n  font-size: 28rpx;\n  text-decoration: none;\n}\n</style>","import MiniProgramPage from 'D:/软工大作业/小程序界面/pages/user/login/login.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni","uniCloud","__rest"],"mappings":";;AAmCA,MAAA,YAAeA,8BAAA;AAAA,EACb,OAAI;AACF,WAAO;AAAA,MACL,UAAU;AAAA,MACV,UAAU;AAAA;EAEb;AAAA,EACD,SAAS;AAAA,IACD,gBAAa;;AACX,cAAA,KAAyB,MAAvB,wBAAU;AAElB,YAAI,CAAC,YAAY,CAAC,UAAU;AAC1BC,wBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,OAAK,CAAG;AACjD,iBAAM,QAAA,QAAA,IAAA;AAAA,QACR;AAEA,YAAI;AACF,gBAAM,MAAM,MAAMC,cAAQ,GAAC,aAAa;AAAA,YACtC,MAAM;AAAA,YACN,MAAM,IAAA,cAAA;AAAA,cACJ,QAAQ;AAAA,cACR;AAAA,cACA;AAAA,aACF;AAAA,UACD,CAAA;AAEDD,wBAAG,MAAC,MAAM,OAAM,qCAAoC,YAAY,GAAG;AAE7D,gBAAA,KAA0B,IAAI,4BAAU,CAAE,CAAA,GAAxC,OAAI,GAAA,MAAE,UAAO,GAAA,SAAE;AAEvBA,wBAAAA,MAAI,MAAM,OAAM,qCAAoC,SAAO,IAAA,cAAE,EAAE,MAAM,SAAS,KAAG,CAAG,CAAC;AAErF,cAAI,SAAS,KAAK,QAAQ,KAAK,OAAO;AAE5B,kBAAA,QAAuB,KAAlB,OAAK,WAASE,cAAAA,OAAI,MAAzB,CAAqB,OAAA,CAAA;AAE3BF,0BAAG,MAAC,MAAM,OAAM,qCAAoC,cAAc,QAAQ;AAG1EA,0BAAAA,MAAI,eAAe,gBAAgB,KAAK;AACxCA,0BAAAA,MAAI,eAAe,aAAa,QAAQ;AAGxCA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,MAAM;AAAA,cACN,UAAU;AAAA,YACX,CAAA;AAGD,uBAAW,MAAA;AACTA,4BAAAA,MAAI,UAAU;AAAA,gBACZ,KAAK;AAAA,cACN,CAAA;AAAA,YACF,GAAE,IAAI;AAAA,UAEP,OAAK;AAELA,0BAAAA,MAAI,MAAM,SAAQ,qCAAoC,SAAS,IAAA,cAAA,EAAE,MAAM,SAAS,KAAG,CAAG;AAEtF,gBAAI,eAAe;AACnB,gBAAI,SAAS;AACX,6BAAe;AAAA,YACjB,WAAW,SAAS,MAAM;AACxB,6BAAe;AAAA,YACjB,WAAW,SAAS,MAAM;AACxB,6BAAe;AAAA,YACjB,WAAW,SAAS,MAAM;AACxB,6BAAe;AAAA,YACjB;AAEAA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,MAAM;AAAA,cACN,UAAU;AAAA,YACX,CAAA;AAAA,UACH;AAAA,QACA,SAAO,KAAK;AACZA,wBAAG,MAAC,MAAM,SAAQ,sCAAqC,WAAW,GAAG;AAErE,cAAI,eAAe;AAGnB,cAAI,OAAO,OAAO,QAAQ,UAAU;AAClC,gBAAI,IAAI,WAAW,IAAI,QAAQ;AAC7B,6BAAe,IAAI,UAAU,SAAS,IAAI,OAAO;AAAA,YACnD,WAAW,IAAI,SAAS;AACtB,6BAAe,IAAI;AAAA,YACrB;AAAA,UACF;AAEAA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,YACN,UAAU;AAAA,UACX,CAAA;AAAA,QACH;AAAA,OACF;AAAA,IAAA;AAAA,EACF;CACD;;;;;;;;;;;;;ACrID,GAAG,WAAW,eAAe;"}