{"version":3,"file":"register.js","sources":["pages/user/register/register.uvue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9yZWdpc3Rlci9yZWdpc3Rlci51dnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <view class=\"card\">\n      <!-- 返回按钮 -->\n      <view class=\"back-btn\" @click=\"goBackToLogin\">← 返回登录</view>\n\n      <view class=\"title\">注册新账号</view>\n\n      <form @submit=\"onRegisterSubmit\">\n        <view class=\"input-group\">\n          <text class=\"label\">用户名</text>\n          <input\n            type=\"text\"\n            placeholder=\"请输入用户名\"\n            v-model=\"username\"\n            :disabled=\"isLoading\"\n          />\n        </view>\n\n        <view class=\"input-group\">\n          <text class=\"label\">设置密码</text>\n          <input\n            type=\"password\"\n            placeholder=\"请输入密码（至少6位）\"\n            v-model=\"password\"\n            :disabled=\"isLoading\"\n          />\n        </view>\n\n        <view class=\"input-group\">\n          <text class=\"label\">确认密码</text>\n          <input\n            type=\"password\"\n            placeholder=\"请再次输入密码\"\n            v-model=\"confirmPassword\"\n            :disabled=\"isLoading\"\n          />\n        </view>\n\n        <button \n          form-type=\"submit\" \n          class=\"btn-register\" \n          :disabled=\"isLoading\"\n          :loading=\"isLoading\"\n        >\n          {{ isLoading ? '注册中...' : '注册' }}\n        </button>\n      </form>\n    </view>\n  </view>\n</template>\n\n<script lang=\"uts\">\nexport default {\n  data() {\n    return {\n      username: '',\n      password: '',\n      confirmPassword: '',\n      isLoading: false\n    };\n  },\n  methods: {\n    async onRegisterSubmit() {\n      \n      const { username, password, confirmPassword } = this;\n\n      // 表单验证\n      if (!username.trim()) {\n        uni.showToast({\n          title: '请输入用户名',\n          icon: 'none'\n        });\n        return;\n      }\n\n      if (!password) {\n        uni.showToast({\n          title: '请输入密码',\n          icon: 'none'\n        });\n        return;\n      }\n\n      if (password.length < 6) {\n        uni.showToast({\n          title: '密码长度至少6位',\n          icon: 'none'\n        });\n        return;\n      }\n\n      if (password !== confirmPassword) {\n        uni.showToast({\n          title: '两次密码不一致',\n          icon: 'none'\n        });\n        return;\n      }\n\n      // 开始注册\n      this.isLoading = true;\n      \n      try {\n        const res = await uniCloud.callFunction({\n          name: 'user-api',\n          data: {\n            action: 'register',\n            username: username.trim(),\n            password\n          }\n        });\n\n        uni.__f__('log','at pages/user/register/register.uvue:114','注册返回结果:', res);\n\n        const { code, message, data } = res.result || {};\n\n        if (code === 0 && data && data.token) {\n          // 注册成功，自动登录\n          const { token, ...userInfo } = data;\n          \n          uni.setStorageSync('uni_id_token', token);\n          uni.setStorageSync('user_info', userInfo);\n          \n          uni.showToast({\n            title: '注册成功',\n            icon: 'success',\n            duration: 1500\n          });\n\n          // 延迟跳转到首页\n          setTimeout(() => {\n            uni.switchTab({\n              url: '/pages/content/list/list'\n            });\n          }, 1500);\n        } else {\n          // 注册失败\n          let errorMessage = '注册失败';\n          \n          if (message) {\n            errorMessage = message;\n          } else if (code === 1004) {\n            errorMessage = '用户名已存在';\n          } else if (code === 1002) {\n            errorMessage = '密码错误';\n          } else if (code === 1003) {\n            errorMessage = '账号已被禁用';\n          }\n          \n          uni.showToast({\n            title: errorMessage,\n            icon: 'none',\n            duration: 3000\n          });\n        }\n      } catch (err) {\n        uni.__f__('error','at pages/user/register/register.uvue:158','注册请求失败:', err);\n        \n        let errorMessage = '注册失败，请稍后重试';\n        if (err && err.errMsg) {\n          errorMessage = err.errMsg;\n        } else if (err && err.message) {\n          errorMessage = err.message;\n        }\n        \n        uni.showToast({\n          title: errorMessage,\n          icon: 'none',\n          duration: 3000\n        });\n      } finally {\n        this.isLoading = false;\n      }\n    },\n\n    goBackToLogin() {\n      uni.redirectTo({\n        url: '/pages/user/login/login'\n      });\n    }\n  }\n};\n</script>\n\n<style>\n.container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  min-height: 100vh;\n  background-color: #f5f5f5;\n  padding: 40rpx 0;\n}\n\n.card {\n  width: 90%;\n  max-width: 947rpx;\n  padding: 50rpx 40rpx;\n  border-radius: 50rpx;\n  background-color: white;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  margin: 0 auto;\n}\n\n.back-btn {\n  font-size: 32rpx;\n  color: #007aff;\n  margin-bottom: 30rpx;\n  cursor: pointer;\n  display: inline-block;\n  padding: 10rpx 0;\n}\n\n.back-btn:active {\n  opacity: 0.7;\n}\n\n.title {\n  font-size: 40rpx;\n  font-weight: bold;\n  color: #333;\n  margin-bottom: 50rpx;\n  text-align: center;\n}\n\n.input-group {\n  margin-bottom: 30rpx;\n}\n\n.label {\n  display: block;\n  margin-bottom: 10rpx;\n  font-size: 30rpx;\n  color: #555;\n  font-weight: 500;\n}\n\ninput {\n  width: 100%;\n  padding: 10rpx;\n  border: 1rpx solid #ddd;\n  border-radius: 10rpx;\n  font-size: 25rpx;\n  box-sizing: border-box;\n  background-color: #f9f9f9;\n}\n\ninput:focus {\n  border-color: #007aff;\n  background-color: white;\n}\n\ninput:disabled {\n  background-color: #f0f0f0;\n  color: #999;\n}\n\n.btn-register {\n  width: 100%;\n  margin-top: 50rpx;\n  background-color: #007aff;\n  color: white;\n  border-radius: 30rpx;\n  font-size: 32rpx;\n  padding: 20rpx;\n  border: none;\n  font-weight: 500;\n}\n\n.btn-register:disabled {\n  background-color: #cccccc;\n  color: #666666;\n}\n\n.btn-register:not(:disabled):active {\n  opacity: 0.8;\n}\n\n/* 响应式调整 */\n@media (max-width: 750rpx) {\n  .card {\n    width: 95%;\n    padding: 40rpx 30rpx;\n  }\n  \n  .title {\n    font-size: 36rpx;\n    margin-bottom: 40rpx;\n  }\n  \n  .label {\n    font-size: 28rpx;\n  }\n  \n  input {\n    font-size: 28rpx;\n    padding: 16rpx;\n  }\n  \n  .btn-register {\n    font-size: 30rpx;\n    padding: 18rpx;\n    margin-top: 40rpx;\n  }\n}\n\n/* 确保在滚动时注册按钮始终可见 */\n.container {\n  position: relative;\n  min-height: 100vh;\n}\n\n.card {\n  position: relative;\n  overflow: visible;\n}\n\n.btn-register {\n  position: relative;\n  z-index: 10;\n}\n</style>","import MiniProgramPage from 'D:/软工大作业/小程序界面/pages/user/register/register.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni","uniCloud","__rest"],"mappings":"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"}