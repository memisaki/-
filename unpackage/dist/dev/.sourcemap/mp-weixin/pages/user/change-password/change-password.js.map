{"version":3,"file":"change-password.js","sources":["pages/user/change-password/change-password.uvue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9jaGFuZ2UtcGFzc3dvcmQvY2hhbmdlLXBhc3N3b3JkLnV2dWU"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 左上角返回按钮 -->\n    <view class=\"back-btn\" @click=\"onBackTap\">\n      ← 返回\n    </view>\n\n    <!-- 垂直居中的表单区域 -->\n    <view class=\"form-wrapper\">\n      <view class=\"form\">\n        <view class=\"input-group\">\n          <text class=\"label\">原密码</text>\n          <input\n            type=\"password\"\n            :value=\"oldPassword\"\n            @input=\"onOldPasswordInput\"\n            placeholder=\"请输入当前密码\"\n          />\n        </view>\n\n        <view class=\"input-group\">\n          <text class=\"label\">新密码</text>\n          <input\n            type=\"password\"\n            :value=\"newPassword\"\n            @input=\"onNewPasswordInput\"\n            placeholder=\"6-20位字符\"\n          />\n        </view>\n\n        <view class=\"input-group\">\n          <text class=\"label\">确认新密码</text>\n          <input\n            type=\"password\"\n            :value=\"confirmPassword\"\n            @input=\"onConfirmPasswordInput\"\n            placeholder=\"请再次输入新密码\"\n          />\n        </view>\n\n        <button class=\"btn-submit\" @click=\"handleSubmit\">确认修改</button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup lang=\"uts\">\nimport { ref } from 'vue'\n\n// 数据响应式\nconst oldPassword = ref('')\nconst newPassword = ref('')\nconst confirmPassword = ref('')\n\n// 输入事件处理\nfunction onOldPasswordInput(e) {\n  oldPassword.value = e.detail.value\n}\nfunction onNewPasswordInput(e) {\n  newPassword.value = e.detail.value\n}\nfunction onConfirmPasswordInput(e) {\n  confirmPassword.value = e.detail.value\n}\n\n// 返回上一页\nfunction onBackTap() {\n  uni.navigateBack({ delta: 1 })\n}\n\n// 提交修改（真实调用云函数）\nasync function handleSubmit() {\n  const oldPwd = oldPassword.value.trim()\n  const newPwd = newPassword.value.trim()\n  const confirmPwd = confirmPassword.value.trim()\n  \r\n  // 获取 token（从本地存储）\r\n  const token = uni.getStorageSync('uni_id_token')\r\n  if (!token) {\r\n    uni.showToast({ title: '请先登录', icon: 'none' })\r\n    setTimeout(() => uni.redirectTo({ url: '/pages/user/login/login' }), 1500)\r\n    return\r\n  }\r\n  \n  if (!oldPwd) {\n    uni.showToast({ title: '请输入原密码', icon: 'none' })\n    return\n  }\n  if (!newPwd || newPwd.length < 6) {\n    uni.showToast({ title: '新密码至少6位', icon: 'none' })\n    return\n  }\n  if (newPwd !== confirmPwd) {\n    uni.showToast({ title: '两次密码不一致', icon: 'none' })\n    return\n  }\n\n  try {\n    // 显示加载中\n    uni.showLoading({ title: '修改中...' })\n\n    // 调用云函数 update-password\n    const res = await uniCloud.callFunction({\r\n          name: 'user-api',\r\n          data: {\r\n            action: 'update-password',\r\n            uniIdToken: token, \r\n            old_password: oldPwd,\r\n            new_password: newPwd,\r\n            confirm_password: confirmPwd\r\n          }\r\n        })\n\n    // 隐藏加载\n    uni.hideLoading()\n\n    const { code, message } = res.result\n\n    if (code === 0) {\n      uni.showToast({ title: '密码修改成功', icon: 'success' })\n      setTimeout(() => {\n        uni.navigateBack()\n      }, 1500)\n    } else {\n      // 常见错误码处理（可扩展）\n      let msg = message || '修改失败'\n      if (code === 1002) {\n        msg = '原密码错误'\n      } else if (code === 401) {\n        msg = '请先登录'\n      }\n      uni.showToast({ title: msg, icon: 'none', duration: 2000 })\n    }\n  } catch (err) {\n    uni.hideLoading()\n    uni.__f__('error','at pages/user/change-password/change-password.uvue:136','[修改密码错误]', err)\n    uni.showToast({ title: '网络异常，请重试', icon: 'none' })\n  }\n}\n</script>\r\n\n<style>\n.container {\n  position: relative;\n  height: 100vh;\n  background-color: #f8f9fa;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 0 40rpx;\n  box-sizing: border-box;\n}\n\n/* 左上角返回按钮 */\n.back-btn {\n  position: absolute;\n  top: 110rpx;\n  left: 40rpx;\n  font-size: 32rpx;\n  color: #007aff;\n  z-index: 10;\n  user-select: none;\n  cursor: pointer;\n}\n\n/* 表单容器：确保在中间 */\n.form-wrapper {\n  width: 100%;\n  max-width: 600rpx;\n  display: flex;\n  justify-content: center;\n  box-sizing: border-box;\n}\n\n.form {\n  background: white;\n  border-radius: 30rpx;\n  padding: 60rpx 40rpx;\n  box-shadow: 0 4rpx 20rpx rgba(0, 0, 0, 0.08);\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.input-group {\n  margin-bottom: 70rpx;\n  width: 100%;\n}\n\n.label {\n  display: block;\n  font-size: 32rpx;\n  color: #555;\n  margin-bottom: 15rpx;\n}\n\ninput {\n  width: 100%;\n  padding: 16rpx 24rpx;\n  height: 80rpx;\n  border: 1rpx solid #ddd;\n  border-radius: 10rpx;\n  font-size: 28rpx;\n  line-height: 1.4;\n  box-sizing: border-box;\n  text-align: left;\n}\n\n.btn-submit {\n  width: 100%;\n  background-color: #007aff;\n  color: white;\n  border-radius: 30rpx;\n  font-size: 32rpx;\n  padding: 30rpx;\n  margin-top: 20rpx;\n  border: none;\n  outline: none;\n}\n</style>","import MiniProgramPage from 'D:/软工大作业/小程序界面/pages/user/change-password/change-password.uvue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","uniCloud","MiniProgramPage"],"mappings":";;;;;AAkDA,UAAM,cAAcA,kBAAI,EAAE;AAC1B,UAAM,cAAcA,kBAAI,EAAE;AAC1B,UAAM,kBAAkBA,kBAAI,EAAE;AAG9B,aAAS,mBAAmB,IAAC,MAAA;AAC3B,kBAAY,QAAQ,EAAE,OAAO;AAAA,IAC/B;AACA,aAAS,mBAAmB,IAAC,MAAA;AAC3B,kBAAY,QAAQ,EAAE,OAAO;AAAA,IAC/B;AACA,aAAS,uBAAuB,IAAC,MAAA;AAC/B,sBAAgB,QAAQ,EAAE,OAAO;AAAA,IACnC;AAGA,aAAS,YAAS;AAChBC,oBAAG,MAAC,aAAa,IAAA,cAAA,EAAE,OAAO,EAAG,CAAA,CAAA;AAAA,IAC/B;AAGA,aAAe,eAAY;;AACzB,cAAM,SAAS,YAAY,MAAM,KAAI;AACrC,cAAM,SAAS,YAAY,MAAM,KAAI;AACrC,cAAM,aAAa,gBAAgB,MAAM,KAAI;AAG7C,cAAM,QAAQA,cAAAA,MAAI,eAAe,cAAc;AAC/C,YAAI,CAAC,OAAO;AACVA,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAM,CAAE;AAC7C,qBAAW,MAAM;AAAA,mBAAAA,cAAG,MAAC,WAAW,EAAE,KAAK,2BAA2B;AAAA,aAAG,IAAI;AACzE,iBAAM,QAAA,QAAA,IAAA;AAAA,QACP;AAED,YAAI,CAAC,QAAQ;AACXA,wBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,OAAM,CAAE;AAC/C,iBAAM,QAAA,QAAA,IAAA;AAAA,QACP;AACD,YAAI,CAAC,UAAU,OAAO,SAAS,GAAG;AAChCA,wBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,OAAM,CAAE;AAChD,iBAAM,QAAA,QAAA,IAAA;AAAA,QACP;AACD,YAAI,WAAW,YAAY;AACzBA,wBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,OAAM,CAAE;AAChD,iBAAM,QAAA,QAAA,IAAA;AAAA,QACP;AAED,YAAI;AAEFA,wBAAAA,MAAI,YAAY,EAAE,OAAO,SAAU,CAAA;AAGnC,gBAAM,MAAM,MAAMC,cAAQ,GAAC,aAAa;AAAA,YAClC,MAAM;AAAA,YACN,MAAM,IAAA,cAAA;AAAA,cACJ,QAAQ;AAAA,cACR,YAAY;AAAA,cACZ,cAAc;AAAA,cACd,cAAc;AAAA,cACd,kBAAkB;AAAA,aACnB;AAAA,UACF,CAAA;AAGLD,wBAAG,MAAC,YAAW;AAET,gBAAA,KAAoB,IAAI,QAAtB,OAAI,GAAA,MAAE,UAAO,GAAA;AAErB,cAAI,SAAS,GAAG;AACdA,0BAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,UAAS,CAAE;AAClD,uBAAW,MAAA;AACTA,4BAAG,MAAC,aAAY;AAAA,YACjB,GAAE,IAAI;AAAA,UACR,OAAM;AAEL,gBAAI,MAAM,WAAW;AACrB,gBAAI,SAAS,MAAM;AACjB,oBAAM;AAAA,YACP,WAAU,SAAS,KAAK;AACvB,oBAAM;AAAA,YACP;AACDA,gCAAI,UAAU,EAAE,OAAO,KAAK,MAAM,QAAQ,UAAU,IAAI,CAAE;AAAA,UAC3D;AAAA,QACF,SAAQ,KAAK;AACZA,wBAAG,MAAC,YAAW;AACfA,wBAAG,MAAC,MAAM,SAAQ,0DAAyD,YAAY,GAAG;AAC1FA,wBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,OAAM,CAAE;AAAA,QAClD;AAAA,OACF;AAAA,IAAA;;;;;;;;;;;;;;;;;;ACzID,GAAG,WAAWE,SAAe;"}